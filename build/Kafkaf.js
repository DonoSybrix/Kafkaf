'use strict';var COMPILED=!0,goog=goog||{};goog.global=this;goog.isDef=function(a){return void 0!==a};goog.exportPath_=function(a,b,c){a=a.split(".");c=c||goog.global;a[0]in c||!c.execScript||c.execScript("var "+a[0]);for(var d;a.length&&(d=a.shift());)!a.length&&goog.isDef(b)?c[d]=b:c=c[d]?c[d]:c[d]={}};
goog.define=function(a,b){var c=b;COMPILED||(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,a)?c=goog.global.CLOSURE_UNCOMPILED_DEFINES[a]:goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,a)&&(c=goog.global.CLOSURE_DEFINES[a]));goog.exportPath_(a,c)};goog.DEBUG=!0;goog.LOCALE="en";goog.TRUSTED_SITE=!0;goog.STRICT_MODE_COMPATIBLE=!1;goog.DISALLOW_TEST_ONLY_CODE=COMPILED&&!goog.DEBUG;
goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING=!1;goog.provide=function(a){if(!COMPILED&&goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');goog.constructNamespace_(a)};goog.constructNamespace_=function(a,b){if(!COMPILED){delete goog.implicitNamespaces_[a];for(var c=a;(c=c.substring(0,c.lastIndexOf(".")))&&!goog.getObjectByName(c);)goog.implicitNamespaces_[c]=!0}goog.exportPath_(a,b)};goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/;
goog.module=function(a){if(!goog.isString(a)||!a||-1==a.search(goog.VALID_MODULE_RE_))throw Error("Invalid module identifier");if(!goog.isInModuleLoader_())throw Error("Module "+a+" has been loaded incorrectly.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");goog.moduleLoaderState_.moduleName=a;if(!COMPILED){if(goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');delete goog.implicitNamespaces_[a]}};goog.module.get=function(a){return goog.module.getInternal_(a)};
goog.module.getInternal_=function(a){if(!COMPILED)return goog.isProvided_(a)?a in goog.loadedModules_?goog.loadedModules_[a]:goog.getObjectByName(a):null};goog.moduleLoaderState_=null;goog.isInModuleLoader_=function(){return null!=goog.moduleLoaderState_};goog.module.declareTestMethods=function(){if(!goog.isInModuleLoader_())throw Error("goog.module.declareTestMethods must be called from within a goog.module");goog.moduleLoaderState_.declareTestMethods=!0};
goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_())throw Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0};
goog.setTestOnly=function(a){if(goog.DISALLOW_TEST_ONLY_CODE)throw a=a||"",Error("Importing test-only code into non-debug environment"+(a?": "+a:"."));};goog.forwardDeclare=function(a){};COMPILED||(goog.isProvided_=function(a){return a in goog.loadedModules_||!goog.implicitNamespaces_[a]&&goog.isDefAndNotNull(goog.getObjectByName(a))},goog.implicitNamespaces_={"goog.module":!0});
goog.getObjectByName=function(a,b){for(var c=a.split("."),d=b||goog.global,e;e=c.shift();)if(goog.isDefAndNotNull(d[e]))d=d[e];else return null;return d};goog.globalize=function(a,b){var c=b||goog.global,d;for(d in a)c[d]=a[d]};goog.addDependency=function(a,b,c,d){if(goog.DEPENDENCIES_ENABLED){var e;a=a.replace(/\\/g,"/");for(var f=goog.dependencies_,g=0;e=b[g];g++)f.nameToPath[e]=a,f.pathIsModule[a]=!!d;for(d=0;b=c[d];d++)a in f.requires||(f.requires[a]={}),f.requires[a][b]=!0}};
goog.ENABLE_DEBUG_LOADER=!0;goog.logToConsole_=function(a){goog.global.console&&goog.global.console.error(a)};
goog.require=function(a){if(!COMPILED){goog.ENABLE_DEBUG_LOADER&&goog.IS_OLD_IE_&&goog.maybeProcessDeferredDep_(a);if(goog.isProvided_(a))return goog.isInModuleLoader_()?goog.module.getInternal_(a):null;if(goog.ENABLE_DEBUG_LOADER){var b=goog.getPathFromDeps_(a);if(b)return goog.included_[b]=!0,goog.writeScripts_(),null}a="goog.require could not find: "+a;goog.logToConsole_(a);throw Error(a);}};goog.basePath="";goog.nullFunction=function(){};
goog.abstractMethod=function(){throw Error("unimplemented abstract method");};goog.addSingletonGetter=function(a){a.getInstance=function(){if(a.instance_)return a.instance_;goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=a);return a.instance_=new a}};goog.instantiatedSingletons_=[];goog.LOAD_MODULE_USING_EVAL=!0;goog.SEAL_MODULE_EXPORTS=goog.DEBUG;goog.loadedModules_={};goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;
goog.DEPENDENCIES_ENABLED&&(goog.included_={},goog.dependencies_={pathIsModule:{},nameToPath:{},requires:{},visited:{},written:{},deferred:{}},goog.inHtmlDocument_=function(){var a=goog.global.document;return"undefined"!=typeof a&&"write"in a},goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH)goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var a=goog.global.document.getElementsByTagName("SCRIPT"),b=a.length-1;0<=b;--b){var c=a[b].src,d=c.lastIndexOf("?"),
d=-1==d?c.length:d;if("base.js"==c.substr(d-7,7)){goog.basePath=c.substr(0,d-7);break}}},goog.importScript_=function(a,b){(goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_)(a,b)&&(goog.dependencies_.written[a]=!0)},goog.IS_OLD_IE_=!goog.global.atob&&goog.global.document&&goog.global.document.all,goog.importModule_=function(a){goog.importScript_("",'goog.retrieveAndExecModule_("'+a+'");')&&(goog.dependencies_.written[a]=!0)},goog.queuedModules_=[],goog.wrapModule_=function(a,b){return goog.LOAD_MODULE_USING_EVAL&&
goog.isDef(goog.global.JSON)?"goog.loadModule("+goog.global.JSON.stringify(b+"\n//# sourceURL="+a+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+b+"\n;return exports});\n//# sourceURL="+a+"\n"},goog.loadQueuedModules_=function(){var a=goog.queuedModules_.length;if(0<a){var b=goog.queuedModules_;goog.queuedModules_=[];for(var c=0;c<a;c++)goog.maybeProcessDeferredPath_(b[c])}},goog.maybeProcessDeferredDep_=function(a){goog.isDeferredModule_(a)&&goog.allDepsAreAvailable_(a)&&(a=goog.getPathFromDeps_(a),
goog.maybeProcessDeferredPath_(goog.basePath+a))},goog.isDeferredModule_=function(a){return(a=goog.getPathFromDeps_(a))&&goog.dependencies_.pathIsModule[a]?goog.basePath+a in goog.dependencies_.deferred:!1},goog.allDepsAreAvailable_=function(a){if((a=goog.getPathFromDeps_(a))&&a in goog.dependencies_.requires)for(var b in goog.dependencies_.requires[a])if(!goog.isProvided_(b)&&!goog.isDeferredModule_(b))return!1;return!0},goog.maybeProcessDeferredPath_=function(a){if(a in goog.dependencies_.deferred){var b=
goog.dependencies_.deferred[a];delete goog.dependencies_.deferred[a];goog.globalEval(b)}},goog.loadModule=function(a){var b=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:void 0,declareTestMethods:!1};var c;if(goog.isFunction(a))c=a.call(goog.global,{});else if(goog.isString(a))c=goog.loadModuleFromSource_.call(goog.global,a);else throw Error("Invalid module definition");var d=goog.moduleLoaderState_.moduleName;if(!goog.isString(d)||!d)throw Error('Invalid module name "'+d+'"');goog.moduleLoaderState_.declareLegacyNamespace?
goog.constructNamespace_(d,c):goog.SEAL_MODULE_EXPORTS&&Object.seal&&Object.seal(c);goog.loadedModules_[d]=c;if(goog.moduleLoaderState_.declareTestMethods)for(var e in c)if(0===e.indexOf("test",0)||"tearDown"==e||"setUp"==e||"setUpPage"==e||"tearDownPage"==e)goog.global[e]=c[e]}finally{goog.moduleLoaderState_=b}},goog.loadModuleFromSource_=function(a){eval(a);return{}},goog.writeScriptSrcNode_=function(a){goog.global.document.write('<script type="text/javascript" src="'+a+'">\x3c/script>')},goog.appendScriptSrcNode_=
function(a){var b=goog.global.document,c=b.createElement("script");c.type="text/javascript";c.src=a;c.defer=!1;c.async=!1;b.head.appendChild(c)},goog.writeScriptTag_=function(a,b){if(goog.inHtmlDocument_()){var c=goog.global.document;if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&"complete"==c.readyState){if(/\bdeps.js$/.test(a))return!1;throw Error('Cannot write "'+a+'" after document load');}var d=goog.IS_OLD_IE_;void 0===b?d?(d=" onreadystatechange='goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+
")' ",c.write('<script type="text/javascript" src="'+a+'"'+d+">\x3c/script>")):goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING?goog.appendScriptSrcNode_(a):goog.writeScriptSrcNode_(a):c.write('<script type="text/javascript">'+b+"\x3c/script>");return!0}return!1},goog.lastNonModuleScriptIndex_=0,goog.onScriptLoad_=function(a,b){"complete"==a.readyState&&goog.lastNonModuleScriptIndex_==b&&goog.loadQueuedModules_();return!0},goog.writeScripts_=function(){function a(e){if(!(e in d.written)){if(!(e in d.visited)&&
(d.visited[e]=!0,e in d.requires))for(var g in d.requires[e])if(!goog.isProvided_(g))if(g in d.nameToPath)a(d.nameToPath[g]);else throw Error("Undefined nameToPath for "+g);e in c||(c[e]=!0,b.push(e))}}var b=[],c={},d=goog.dependencies_,e;for(e in goog.included_)d.written[e]||a(e);for(var f=0;f<b.length;f++)e=b[f],goog.dependencies_.written[e]=!0;var g=goog.moduleLoaderState_;goog.moduleLoaderState_=null;for(f=0;f<b.length;f++)if(e=b[f])d.pathIsModule[e]?goog.importModule_(goog.basePath+e):goog.importScript_(goog.basePath+
e);else throw goog.moduleLoaderState_=g,Error("Undefined script input");goog.moduleLoaderState_=g},goog.getPathFromDeps_=function(a){return a in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[a]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js"));goog.normalizePath_=function(a){a=a.split("/");for(var b=0;b<a.length;)"."==a[b]?a.splice(b,1):b&&".."==a[b]&&a[b-1]&&".."!=a[b-1]?a.splice(--b,2):b++;return a.join("/")};
goog.loadFileSync_=function(a){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(a);var b=new goog.global.XMLHttpRequest;b.open("get",a,!1);b.send();return b.responseText};
goog.retrieveAndExecModule_=function(a){if(!COMPILED){var b=a;a=goog.normalizePath_(a);var c=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_,d=goog.loadFileSync_(a);if(null!=d)d=goog.wrapModule_(a,d),goog.IS_OLD_IE_?(goog.dependencies_.deferred[b]=d,goog.queuedModules_.push(b)):c(a,d);else throw Error("load of "+a+"failed");}};
goog.typeOf=function(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b};goog.isNull=function(a){return null===a};goog.isDefAndNotNull=function(a){return null!=a};goog.isArray=function(a){return"array"==goog.typeOf(a)};goog.isArrayLike=function(a){var b=goog.typeOf(a);return"array"==b||"object"==b&&"number"==typeof a.length};goog.isDateLike=function(a){return goog.isObject(a)&&"function"==typeof a.getFullYear};goog.isString=function(a){return"string"==typeof a};
goog.isBoolean=function(a){return"boolean"==typeof a};goog.isNumber=function(a){return"number"==typeof a};goog.isFunction=function(a){return"function"==goog.typeOf(a)};goog.isObject=function(a){var b=typeof a;return"object"==b&&null!=a||"function"==b};goog.getUid=function(a){return a[goog.UID_PROPERTY_]||(a[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(a){return!!a[goog.UID_PROPERTY_]};goog.removeUid=function(a){"removeAttribute"in a&&a.removeAttribute(goog.UID_PROPERTY_);try{delete a[goog.UID_PROPERTY_]}catch(b){}};
goog.UID_PROPERTY_="closure_uid_"+(1E9*Math.random()>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if(a.clone)return a.clone();var b="array"==b?[]:{},c;for(c in a)b[c]=goog.cloneObject(a[c]);return b}return a};goog.bindNative_=function(a,b,c){return a.call.apply(a.bind,arguments)};
goog.bindJs_=function(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}};goog.bind=function(a,b,c){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};
goog.partial=function(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}};goog.mixin=function(a,b){for(var c in b)a[c]=b[c]};goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date};
goog.globalEval=function(a){if(goog.global.execScript)goog.global.execScript(a,"JavaScript");else if(goog.global.eval)if(null==goog.evalWorksForGlobals_&&(goog.global.eval("var _et_ = 1;"),"undefined"!=typeof goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_)goog.global.eval(a);else{var b=goog.global.document,c=b.createElement("SCRIPT");c.type="text/javascript";c.defer=!1;c.appendChild(b.createTextNode(a));b.body.appendChild(c);
b.body.removeChild(c)}else throw Error("goog.globalEval not available");};goog.evalWorksForGlobals_=null;goog.getCssName=function(a,b){var c=function(a){return goog.cssNameMapping_[a]||a},d=function(a){a=a.split("-");for(var b=[],d=0;d<a.length;d++)b.push(c(a[d]));return b.join("-")},d=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?c:d:function(a){return a};return b?a+"-"+d(b):d(a)};goog.setCssNameMapping=function(a,b){goog.cssNameMapping_=a;goog.cssNameMappingStyle_=b};
!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING);goog.getMsg=function(a,b){b&&(a=a.replace(/\{\$([^}]+)}/g,function(a,d){return d in b?b[d]:a}));return a};goog.getMsgWithFallback=function(a,b){return a};goog.exportSymbol=function(a,b,c){goog.exportPath_(a,b,c)};goog.exportProperty=function(a,b,c){a[b]=c};
goog.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.base=function(a,c,f){for(var g=Array(arguments.length-2),h=2;h<arguments.length;h++)g[h-2]=arguments[h];return b.prototype[c].apply(a,g)}};
goog.base=function(a,b,c){var d=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!d)throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(d.superClass_){for(var e=Array(arguments.length-1),f=1;f<arguments.length;f++)e[f-1]=arguments[f];return d.superClass_.constructor.apply(a,e)}e=Array(arguments.length-2);for(f=2;f<arguments.length;f++)e[f-2]=arguments[f];for(var f=!1,g=a.constructor;g;g=
g.superClass_&&g.superClass_.constructor)if(g.prototype[b]===d)f=!0;else if(f)return g.prototype[b].apply(a,e);if(a[b]===d)return a.constructor.prototype[b].apply(a,e);throw Error("goog.base called from a method of one name to a method of a different name");};goog.scope=function(a){a.call(goog.global)};COMPILED||(goog.global.COMPILED=COMPILED);
goog.defineClass=function(a,b){var c=b.constructor,d=b.statics;c&&c!=Object.prototype.constructor||(c=function(){throw Error("cannot instantiate an interface (no constructor defined).");});c=goog.defineClass.createSealingConstructor_(c,a);a&&goog.inherits(c,a);delete b.constructor;delete b.statics;goog.defineClass.applyProperties_(c.prototype,b);null!=d&&(d instanceof Function?d(c):goog.defineClass.applyProperties_(c,d));return c};goog.defineClass.SEAL_CLASS_INSTANCES=goog.DEBUG;
goog.defineClass.createSealingConstructor_=function(a,b){if(goog.defineClass.SEAL_CLASS_INSTANCES&&Object.seal instanceof Function){if(b&&b.prototype&&b.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_])return a;var c=function(){var b=a.apply(this,arguments)||this;b[goog.UID_PROPERTY_]=b[goog.UID_PROPERTY_];this.constructor===c&&Object.seal(b);return b};return c}return a};goog.defineClass.OBJECT_PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
goog.defineClass.applyProperties_=function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c]);for(var d=0;d<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;d++)c=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[d],Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])};goog.tagUnsealableClass=function(a){!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES&&(a.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0)};goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable";var Core={Application:function(){this.loop=function(a){};this.game=null}};goog.addSingletonGetter(Core.Application);Core.Application.prototype.init=function(a){this.game=a;return this.game.init()};Core.Application.prototype.start=function(){var a=this,b=0;this.loop=function(c){window.requestAnimFrame(a.loop);var d=c-b;b=c;a.update(d);a.render(d)};a.loop(0)};Core.Application.prototype.update=function(a){this.game&&this.game.update(a)};Core.Application.prototype.render=function(a){this.game&&this.game.render(a)};
Core.Application.prototype.onEvent=function(a){if(this.game)this.game.onEvent(a)};Core.Application.prototype.getGame=function(){return this.game};Core.Event=function(){this.type=Core.Event.Type.Unknow;this.y=this.x=0;this.key=null};Core.Event.Type={MouseDown:0,MouseUp:1,MouseMove:2,KeyDown:3,KeyUp:4,WindowResize:5,Unknow:6};document.onmousemove=function(a){var b=new Core.Event;b.type=Core.Event.Type.MouseMove;b.x=a.x;b.y=a.y;if(Core.Application.getInstance())Core.Application.getInstance().onEvent(b)};document.onmousedown=function(a){var b=new Core.Event;b.type=Core.Event.Type.MouseDown;b.x=a.x;b.y=a.y;if(Core.Application.getInstance())Core.Application.getInstance().onEvent(b)};
document.onmouseup=function(a){var b=new Core.Event;b.type=Core.Event.Type.MouseUp;b.x=a.x;b.y=a.y;if(Core.Application.getInstance())Core.Application.getInstance().onEvent(b)};document.onkeydown=function(a){var b=new Core.Event;b.type=Core.Event.Type.KeyDown;b.key=a.keyCode;if(Core.Application.getInstance())Core.Application.getInstance().onEvent(b)};document.onkeyup=function(a){var b=new Core.Event;b.type=Core.Event.Type.KeyUp;b.key=a.keyCode;if(Core.Application.getInstance())Core.Application.getInstance().onEvent(b)};
window.onresize=function(a){a=new Core.Event;a.type=Core.Event.Type.WindowResize;a.x=window.innerWidth;a.y=window.innerHeight;if(Core.Application.getInstance())Core.Application.getInstance().onEvent(a)};Core.Scene=function(){};Core.Scene.prototype.onActivation=function(){};Core.Scene.prototype.onInactivation=function(){};Core.Scene.prototype.onLoad=function(){};Core.Scene.prototype.onUnload=function(){};Core.Scene.prototype.onEvent=function(a){};Core.Scene.prototype.update=function(a){};Core.Scene.prototype.render=function(a){};Core.SceneManager=function(){this.scenes=[];this.waitingScene=this.activeScene=null;this.eventType=Core.SceneManager.EventType.None};Core.SceneManager.EventType={Pop:0,Push:1,Replace:2,None:3};
Core.SceneManager.prototype.update=function(a){if(this.eventType!=Core.SceneManager.EventType.None){switch(this.eventType){case Core.SceneManager.EventType.Pop:this.activeScene.onInactivation();this.activeScene.onUnload();this.activeScene=this.scenes[this.scenes.length-1];this.activeScene.onActivation();this.scenes.pop();break;case Core.SceneManager.EventType.Push:if(this.activeScene)this.activeScene.onInactivation();this.scenes.push(this.waitingScene);this.activeScene=this.waitingScene;this.activeScene.onLoad();
this.activeScene.onActivation();break;case Core.SceneManager.EventType.Replace:this.activeScene&&(this.activeScene.onInactivation(),this.activeScene.onUnload()),this.activeScene=this.waitingScene,this.activeScene.onLoad(),this.activeScene.onActivation(),this.scenes[this.scenes.length-1]=this.waitingScene}this.eventType=Core.SceneManager.EventType.None;this.waitingScene=null}this.activeScene&&this.activeScene.update(a)};Core.SceneManager.prototype.render=function(a){this.activeScene&&this.activeScene.render(a)};
Core.SceneManager.prototype.popScene=function(){if(2>this.scenes.length)return!1;this.eventType=Core.SceneManager.EventType.Pop;return!0};Core.SceneManager.prototype.pushScene=function(a){this.eventType=Core.SceneManager.EventType.Push;this.waitingScene=a};Core.SceneManager.prototype.replaceScene=function(a){0==this.scenes.length?this.pushScene(a):(this.eventType=Core.SceneManager.EventType.Replace,this.waitingScene=a)};Core.SceneManager.prototype.getActiveScene=function(){return this.activeScene};Core.Game=function(){this.sceneManager=new Core.SceneManager};Core.Game.prototype.init=function(){return!0};Core.Game.prototype.update=function(a){this.sceneManager.update(a)};Core.Game.prototype.render=function(a){this.sceneManager.render(a)};Core.Game.prototype.onEvent=function(a){if(this.sceneManager.activeScene)this.sceneManager.activeScene.onEvent(a)};Core.Game.prototype.getSceneManager=function(){return this.sceneManager};var Utils={};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();Utils.loadJSON=function(a,b){var c=new XMLHttpRequest;c.overrideMimeType("application/json");c.open("GET",a,!0);c.onreadystatechange=function(){4==c.readyState&&"200"==c.status&&b(JSON.parse(c.responseText))};c.send(null)};var Kafkaf={Debug:{}};
Kafkaf.Debug.getPIXIDebugDraw=function(a){function b(a){var b=Box2D.wrapPointer(a,Box2D.b2Color);a=16581375*b.get_r()|0;var c=65025*b.get_g()|0,b=255*b.get_b()|0;return a+c+b}function c(a,b,c,d,e){a.lineStyle(0,e,1);d&&a.beginFill(e,.5);for(e=0;e<c;e++){var f=Box2D.wrapPointer(b+8*e,Box2D.b2Vec2);0===e?a.moveTo(f.get_x(),f.get_y()):a.lineTo(f.get_x(),f.get_y())}d&&a.endFill()}function d(a,b,c,d,e,f){b=Box2D.wrapPointer(b,Box2D.b2Vec2);d=Box2D.wrapPointer(d,Box2D.b2Vec2);a.lineStyle(0,f,1);e&&a.beginFill(f,
.5);a.arc(b.get_x(),b.get_y(),c,0,2*Math.PI,!1);e&&a.endFill();e&&(e=new Box2D.b2Vec2(b.get_x(),b.get_y()),e.op_add(new Box2D.b2Vec2(d.get_x()*c,d.get_y()*c)),a.moveTo(b.get_x(),b.get_y()),a.lineTo(e.get_x(),e.get_y()))}function e(a,b,c,d){function e(a,b){return{x:a*m+b*f,y:-a*f+b*m}}var f=Math.sin(d),m=Math.cos(d);d=e(b,c);var n=e(b+100,c);b=e(b,c+100);a.lineStyle(.01,"rgb(192,0,0)",1);a.moveTo(d.x,d.y);a.lineTo(n.x,n.y);a.lineStyle(.01,"rgb(0,192,0)",1);a.moveTo(d.x,d.y);a.lineTo(b.x,b.y)}var f=
new Box2D.JSDraw;f.DrawSegment=function(c,d,e){e=b(e);c=Box2D.wrapPointer(c,Box2D.b2Vec2);d=Box2D.wrapPointer(d,Box2D.b2Vec2);a.lineStyle(0,e,1);a.moveTo(c.get_x(),c.get_y());a.lineTo(d.get_x(),d.get_y())};f.DrawPolygon=function(d,e,f){c(a,d,e,!1,b(f))};f.DrawSolidPolygon=function(d,e,f){c(a,d,e,!0,b(f))};f.DrawCircle=function(c,e,f){d(a,c,e,Box2D.b2Vec2(0,0),!1,b(f))};f.DrawSolidCircle=function(c,e,f,k){d(a,c,e,f,!0,b(k))};f.DrawTransform=function(b){var c=Box2D.wrapPointer(a,Box2D.b2Transform);
b=c.get_p();c=c.get_q();e(a,b.get_x(),b.get_y(),c.GetAngle())};f.SetFlags(1);return f};Kafkaf.Helpers={};Kafkaf.Helpers.EntityBuilder=function(){this.loaders=[];this.prefabs=[]};Kafkaf.Helpers.EntityBuilder.prototype.registerLoader=function(a,b){this.loaders[a]=b};Kafkaf.Helpers.EntityBuilder.prototype.loadPrefabsFromFile=function(a,b){var c=this;Utils.loadJSON(a,function(a){b(c.loadPrefabsFromData(a))});return!0};
Kafkaf.Helpers.EntityBuilder.prototype.loadPrefabsFromData=function(a){a=a.prefabs;for(var b=0;b<a.length;b++){for(var c=Object.keys(a[b]),d=[],e=0;e<c.length;e++)d[c[e]]=a[b][c[e]];this.prefabs[a[b].main.name]=d}return!0};Kafkaf.Helpers.EntityBuilder.prototype.buildEntityFromPrefab=function(a,b){var c=this.prefabs[b];return c?this.buildEntityFromData(a,c):!1};Kafkaf.Helpers.EntityBuilder.prototype.buildEntityFromData=function(a,b){for(var c in b){var d=this.loaders[c];d&&d.loadFromData(a,b[c])}return!0};Kafkaf.Models={};Kafkaf.Models.Configuration=function(){this.controllers=[];this.useMSAA=!0;this.quality=Kafkaf.Models.Configuration.Quality.High;this.showName=!1;this.init()};goog.addSingletonGetter(Kafkaf.Models.Configuration);Kafkaf.Models.Configuration.Quality={Low:0,Medium:1,High:2};
Kafkaf.Models.Configuration.prototype.init=function(){var a=[];a.type="keyboard";a.jump=90;a.left=81;a.right=68;a.action=83;this.controllers[0]=a;a=[];a.type="keyboard";a.jump=38;a.left=37;a.right=39;a.action=40;this.controllers[1]=a;a=[];a.type="keyboard";a.jump=73;a.left=74;a.right=76;a.action=75;this.controllers[2]=a;a=[];a.type="keyboard";a.jump=104;a.left=100;a.right=102;a.action=101;this.controllers[3]=a};
Kafkaf.Models.Configuration.prototype.loadFromFile=function(a,b){var c=this;Utils.loadJSON(a,function(a){c.showName=a.game.showName||!1;c.useMSAA=a.graphics.msaa||!0;c.quality="high"==a.graphics.quality?Kafkaf.Models.Configuration.Quality.High:"medium"==a.graphics.quality?Kafkaf.Models.Configuration.Quality.Medium:Kafkaf.Models.Configuration.Quality.Low;for(var e=c.controllers.length=0;e<a.controls.length;e++){var f=[];f.type=a.controls[e].type;f.jump=a.controls[e].jump;f.left=a.controls[e].left;
f.right=a.controls[e].right;f.action=a.controls[e].action;c.controllers.push(f)}b(!0)})};Kafkaf.Models.Configuration.prototype.getController=function(a){return a>=this.controllers.length?this.controllers[0]:this.controllers[a]};Kafkaf.Modes={};Kafkaf.Modes.GameMode=function(a){this.world=a;this.over=!1};Kafkaf.Modes.GameMode.Mode={TheSurvivor:0,MoneyHunter:1,TheOne:2,TheCollector:3,BombAvoider:4,Race:5};Kafkaf.Modes.GameMode.prototype.update=function(a){};Kafkaf.Modes.GameMode.prototype.onEvent=function(a){};Kafkaf.Modes.GameMode.prototype.isOver=function(){return this.over};Kafkaf.Modes.BombAvoiderMode=function(a){Kafkaf.Modes.GameMode.call(this,a)};goog.inherits(Kafkaf.Modes.BombAvoiderMode,Kafkaf.Modes.GameMode);Kafkaf.Modes.BombAvoiderMode.prototype.update=function(a){};Kafkaf.Modes.BombAvoiderMode.prototype.onEvent=function(a){};Kafkaf.Modes.MoneyHunterMode=function(a){Kafkaf.Modes.GameMode.call(this,a)};goog.inherits(Kafkaf.Modes.MoneyHunterMode,Kafkaf.Modes.GameMode);Kafkaf.Modes.MoneyHunterMode.prototype.update=function(a){};Kafkaf.Modes.MoneyHunterMode.prototype.onEvent=function(a){};Kafkaf.Modes.RaceMode=function(a){Kafkaf.Modes.GameMode.call(this,a)};goog.inherits(Kafkaf.Modes.RaceMode,Kafkaf.Modes.GameMode);Kafkaf.Modes.RaceMode.prototype.update=function(a){};Kafkaf.Modes.RaceMode.prototype.onEvent=function(a){};Kafkaf.Modes.TheCollectorMode=function(a){Kafkaf.Modes.GameMode.call(this,a)};goog.inherits(Kafkaf.Modes.TheCollectorMode,Kafkaf.Modes.GameMode);Kafkaf.Modes.TheCollectorMode.prototype.update=function(a){};Kafkaf.Modes.TheCollectorMode.prototype.onEvent=function(a){};Kafkaf.Modes.TheSurvivorMode=function(a){Kafkaf.Modes.GameMode.call(this,a)};goog.inherits(Kafkaf.Modes.TheSurvivorMode,Kafkaf.Modes.GameMode);Kafkaf.Modes.TheSurvivorMode.prototype.update=function(a){};Kafkaf.Modes.TheSurvivorMode.prototype.onEvent=function(a){};var ES={Component:function(){}};ES.Event=function(){};ES.System=function(a){this.entities=[];this.enabled=!0;this.key=0;this.world=null;if(a)for(var b=0;b<a.length;b++)this.key|=a[b].prototype.UID};ES.System.prototype.addEntity=function(a){this.entities.push(a);this.onEntityAdded(a)};ES.System.prototype.removeEntity=function(a){var b=this.entities.indexOf(a);-1<b&&(this.entities.splice(b,1),this.onEntityRemoved(a))};ES.System.prototype.isPresent=function(a){return-1<this.entities.indexOf(a)};ES.System.prototype.setActif=function(a){this.enabled=a};
ES.System.prototype.update=function(a){};ES.System.prototype.onActivation=function(){};ES.System.prototype.onInactivation=function(){};ES.System.prototype.onEntityAdded=function(a){};ES.System.prototype.onEntityRemoved=function(a){};ES.System.prototype.onClear=function(){};ES.System.prototype.onEvent=function(a){};ES.Utils=function(){};ES.Utils.nextID=0;ES.Utils.extend=function(a,b){goog.inherits(b,a);b.prototype.UID=1<<ES.Utils.nextID;ES.Utils.nextID++};Kafkaf.AIComponent=function(){ES.Component.call(this);this.behaviors=[]};ES.Utils.extend(ES.Component,Kafkaf.AIComponent);Kafkaf.AIComponent.Type={Unknow:0,AutomaticRotation:1,AvoidWalls:2,AttackNearEntity:4,AutoExplode:8};Kafkaf.AIComponent.prototype.addBehavior=function(a,b){this.behaviors.push({type:a,value:b})};Kafkaf.CollisionListenerComponent=function(){ES.Component.call(this);this.callbacks=[]};ES.Utils.extend(ES.Component,Kafkaf.CollisionListenerComponent);Kafkaf.CollisionListenerComponent.Type={Begin:0,End:1,PreSolve:2,PostSolve:3};Kafkaf.CollisionData=function(){this.fixtureB=this.fixtureA=this.entityB=this.entityA=null;this.normal=[]};Kafkaf.ControllableComponent=function(){ES.Component.call(this);this.keyActions=[];this.keyPressed=[];for(var a=Kafkaf.ControllableComponent.ControlType.Unknow;a<=Kafkaf.ControllableComponent.ControlType.Right;a++)this.keyPressed[a]=!1};ES.Utils.extend(ES.Component,Kafkaf.ControllableComponent);Kafkaf.ControllableComponent.ControlType={Unknow:0,Up:1,Down:2,Left:3,Right:4};Kafkaf.ControllableComponent.prototype.setKey=function(a,b){this.keyActions[a]=b};
Kafkaf.ControllableComponent.prototype.convertToAction=function(a){for(var b=Kafkaf.ControllableComponent.ControlType.Up;b<=Kafkaf.ControllableComponent.ControlType.Right;b++)if(this.keyActions[b]==a)return b;return Kafkaf.ControllableComponent.ControlType.Unknow};Kafkaf.JumpComponent=function(a,b){ES.Component.call(this);this.force=a||10;this.max=b||1;this.jumpTimeOut=this.count=0;this.timeBetweenJump=250};ES.Utils.extend(ES.Component,Kafkaf.JumpComponent);Kafkaf.LifeComponent=function(a){ES.Component.call(this);this.amount=a};ES.Utils.extend(ES.Component,Kafkaf.LifeComponent);Kafkaf.MoveComponent=function(a){ES.Component.call(this);this.maxSpeed=10;this.speed=a||10;this.accelerationScale=.7;this.decelerationScale=.9;this.airResistanceScale=.995;this.normal=0};ES.Utils.extend(ES.Component,Kafkaf.MoveComponent);Kafkaf.PhysicBodyComponent=function(a){ES.Component.call(this);this.instance=a};ES.Utils.extend(ES.Component,Kafkaf.PhysicBodyComponent);Kafkaf.PhysicBodyComponent.BodyType={Static:0,Dynamic:1,Kinematic:2};Kafkaf.PhysicBodyComponent.ShapeType={Circle:0,Box:1,Polygon:2};Kafkaf.PhysicBodyComponent.prototype.setActive=function(a){this.instance.SetActive(a)};Kafkaf.PhysicBodyComponent.prototype.setAsBullet=function(a){this.instance.SetBullet(a)};Kafkaf.PhysicBodyComponent.prototype.setFixedRotation=function(a){this.instance.SetFixedRotation(a)};
Kafkaf.PhysicBodyComponent.prototype.setType=function(a){a==Kafkaf.PhysicBodyComponent.BodyType.Static?this.instance.SetType(b2_staticBody):a==Kafkaf.PhysicBodyComponent.BodyType.Dynamic?this.instance.SetType(b2_dynamicBody):this.instance.SetType(b2_kinematicBody)};Kafkaf.PhysicBodyComponent.prototype.setGravityScale=function(a){this.instance.SetGravityScale(a)};Kafkaf.PhysicBodyComponent.prototype.setAngularDamping=function(a){this.instance.SetAwake(!0);this.instance.SetAngularDamping(a)};
Kafkaf.PhysicBodyComponent.prototype.setAngularVelocity=function(a){this.instance.SetAwake(!0);this.instance.SetAngularVelocity(a)};Kafkaf.PhysicBodyComponent.prototype.setLinearDamping=function(a){this.instance.SetAwake(!0);this.instance.SetLinearDamping(a)};Kafkaf.PhysicBodyComponent.prototype.setLinearVelocity=function(a,b){this.instance.SetAwake(!0);this.instance.SetLinearVelocity(new b2Vec2(a,b))};
Kafkaf.PhysicBodyComponent.prototype.applyForce=function(a,b){this.instance.SetAwake(!0);this.instance.ApplyForce(new b2Vec2(a[0],a[1]),new b2Vec2(b[0],b[1]),!0)};Kafkaf.PhysicBodyComponent.prototype.applyAngularImpulse=function(a){this.instance.SetAwake(!0);this.instance.ApplyAngularImpulse(a,!0)};Kafkaf.PhysicBodyComponent.prototype.applyLinearImpulse=function(a,b){this.instance.SetAwake(!0);this.instance.ApplyLinearImpulse(new b2Vec2(a[0],a[1]),new b2Vec2(b[0],b[1]),!0)};
Kafkaf.PhysicBodyComponent.prototype.applyTorque=function(a){this.instance.SetAwake(!0);this.instance.ApplyTorque(a,!0)};Kafkaf.PhysicBodyComponent.prototype.getMass=function(){return this.instance.GetMass()};Kafkaf.PhysicBodyComponent.prototype.getVelocity=function(){var a=this.instance.GetLinearVelocity();return[a.get_x(),a.get_y()]};Kafkaf.PhysicBodyComponent.prototype.getPosition=function(){var a=this.instance.GetPosition();return[a.get_x(),a.get_y()]};
Kafkaf.PhysicBodyComponent.prototype.getRotation=function(){return this.instance.GetAngle()};Kafkaf.PhysicBodyComponent.prototype.getType=function(){switch(this.instance.GetType()){case b2_staticBody:return Kafkaf.PhysicBodyComponent.BodyType.Static;case b2_dynamicBody:return Kafkaf.PhysicBodyComponent.BodyType.Dynamic}return Kafkaf.PhysicBodyComponent.BodyType.Kinematic};Kafkaf.SpriteComponent=function(a){ES.Component.call(this);this.instance=a};ES.Utils.extend(ES.Component,Kafkaf.SpriteComponent);Kafkaf.TransformComponent=function(){ES.Component.call(this);this.position={x:0,y:0};this.scale={x:1,y:1};this.rotation=0};ES.Utils.extend(ES.Component,Kafkaf.TransformComponent);Kafkaf.Event={};Kafkaf.Event.DamageEvent=function(a,b){this.victim=a;this.agressor=b};ES.Utils.extend(ES.Event,Kafkaf.Event.DamageEvent);Kafkaf.Event.DeadEvent=function(a,b){this.victim=a;this.killer=b};ES.Utils.extend(ES.Event,Kafkaf.Event.DeadEvent);Kafkaf.Event.GameEvent=function(a){this.type=a};ES.Utils.extend(ES.Event,Kafkaf.Event.GameEvent);Kafkaf.Event.GameEvent.Type={GameOver:0};Kafkaf.Event.JumpEvent=function(a,b){this.entity=b;this.type=a};ES.Utils.extend(ES.Event,Kafkaf.Event.JumpEvent);Kafkaf.Event.JumpEvent.Type={AskToJump:0,ResetCounter:1};Kafkaf.Event.MoveEvent=function(a,b){this.entity=a;this.normal=b||0};ES.Utils.extend(ES.Event,Kafkaf.Event.MoveEvent);Kafkaf.Event.UserEvent=function(a){this.event=a};ES.Utils.extend(ES.Event,Kafkaf.Event.UserEvent);Kafkaf.Loaders={};Kafkaf.Loaders.AILoader=function(){};
Kafkaf.Loaders.AILoader.prototype.loadFromData=function(a,b){for(var c=new Kafkaf.AIComponent,d=0;d<b.types.length;d++){var e=b.types[d].value||0,f=Kafkaf.AIComponent.Type.Unknow;switch(b.types[d].name){case "AutomaticRotation":f=Kafkaf.AIComponent.Type.AutomaticRotation;break;case "AvoidWalls":f=Kafkaf.AIComponent.Type.AvoidWalls;break;case "AttackNearEntity":f=Kafkaf.AIComponent.Type.AttackNearEntity;break;case "AutoExplode":f=Kafkaf.AIComponent.Type.AutoExplode;break;default:continue}c.addBehavior(f,
e)}a.addComponent(c);return!0};Kafkaf.Loaders.CollisionListenerLoader=function(){};Kafkaf.Loaders.CollisionListenerLoader.prototype.loadFromData=function(a,b){var c=new Kafkaf.CollisionListenerComponent;c[0]=b.begin||"";c[1]=b.end||"";c[2]=b.presolve||"";c[3]=b.postsolve||"";a.addComponent(c);return!0};Kafkaf.Loaders.PhysicBodyLoader=function(a){this.physicWorld=a.physicWorld};
Kafkaf.Loaders.PhysicBodyLoader.prototype.loadFromData=function(a,b){var c=a.getComponent(Kafkaf.TransformComponent),d=new b2BodyDef;switch(b.type){case "dynamic":d.set_type(b2_dynamicBody);break;case "kinematic":d.set_type(b2_kinematicBody);break;default:d.set_type(b2_staticBody)}d=this.physicWorld.CreateBody(d);d.SetUserData(a);d.userData=a;d.SetFixedRotation(b.fixedRotation||!1);for(var e=0;e<b.fixtures.length;e++){var f=new b2FixtureDef;f.set_density(b.fixtures[e].density||1);f.set_friction(b.fixtures[e].friction||
.1);f.set_restitution(b.fixtures[e].restitution||.2);f.set_isSensor(b.fixtures[e].sensor||!1);var g=b.fixtures[e].shape.offset||{x:0,y:0},h=b.fixtures[e].shape.angle||0;if("circle"==b.fixtures[e].shape.type){var l=b.fixtures[e].shape.size*c.scale.x*.5-.01,k=new b2CircleShape;k.set_m_p(new b2Vec2(g.x,g.y));k.set_m_radius(l);f.set_shape(k)}else if("box"==b.fixtures[e].shape.type)l={},l.x=b.fixtures[e].shape.size.x*c.scale.x*.5-.01,l.y=b.fixtures[e].shape.size.y*c.scale.y*.5-.01,k=new b2PolygonShape,
k.SetAsBox(l.x,l.y,new b2Vec2(g.x,g.y),h),f.set_shape(k);else{g=[];for(h=0;h<b.fixtures[e].shape.vertices.length;h++)g.push(new b2Vec2(b.fixtures[e].shape.vertices[h].x,b.fixtures[e].shape.vertices[h].y));f.set_shape(createPolygonShape(g))}b.fixtures[e].filter&&(f.get_filter().set_categoryBits(void 0!=b.fixtures[e].filter.category?b.fixtures[e].filter.category:1),f.get_filter().set_maskBits(void 0!=b.fixtures[e].filter.mask?b.fixtures[e].filter.mask:65535),f.get_filter().set_groupIndex(void 0!=b.fixtures[e].filter.group?
b.fixtures[e].filter.group:0));d.CreateFixture(f).userData=b.fixtures[e].name||null}d.SetTransform(new b2Vec2(c.position.x,c.position.y),c.rotation*Math.PI/180);a.addComponent(new Kafkaf.PhysicBodyComponent(d));return!0};Kafkaf.Loaders.SpriteLoader=function(){};Kafkaf.Loaders.SpriteLoader.prototype.loadFromData=function(a,b){var c=PIXI.Texture.fromImage(b.texture),c=new PIXI.Sprite(c);c.anchor.x=.5;c.anchor.y=.5;a.addComponent(new Kafkaf.SpriteComponent(c));return!0};Kafkaf.AISystem=function(){ES.System.call(this,[Kafkaf.AIComponent])};ES.Utils.extend(ES.System,Kafkaf.AISystem);Kafkaf.AISystem.prototype.update=function(a){for(a=0;a<this.entities.length;a++)for(var b=this.entities[a].getComponent(Kafkaf.AIComponent),c=0;c<b.behaviors.length;c++)if(b.behaviors[c].type==Kafkaf.AIComponent.Type.AutomaticRotation){var d=this.entities[a].getComponent(Kafkaf.PhysicBodyComponent);d&&d.setAngularVelocity(b.behaviors[c].value)}};Kafkaf.CollisionListenerSystem=function(){ES.System.call(this,[Kafkaf.CollisionListenerComponent]);this.setActif(!1);this.contactListener=new Box2D.JSContactListener;this.contactListener.BeginContact=this.beginContact;this.contactListener.EndContact=this.endContact;this.contactListener.PreSolve=this.preSolve;this.contactListener.PostSolve=this.postSolve};ES.Utils.extend(ES.System,Kafkaf.CollisionListenerSystem);Kafkaf.CollisionListenerSystem.callbacks=[];
Kafkaf.CollisionListenerSystem.prototype.registerCollisionSolver=function(a,b){Kafkaf.CollisionListenerSystem.callbacks[a]=b};Kafkaf.CollisionListenerSystem.prototype.beginContact=function(a){Kafkaf.CollisionListenerSystem.notifyEntities(a,Kafkaf.CollisionListenerComponent.Type.Begin)};Kafkaf.CollisionListenerSystem.prototype.endContact=function(a){Kafkaf.CollisionListenerSystem.notifyEntities(a,Kafkaf.CollisionListenerComponent.Type.End)};
Kafkaf.CollisionListenerSystem.prototype.preSolve=function(a,b){Kafkaf.CollisionListenerSystem.notifyEntities(a,Kafkaf.CollisionListenerComponent.Type.PreSolve)};Kafkaf.CollisionListenerSystem.prototype.postSolve=function(a,b){Kafkaf.CollisionListenerSystem.notifyEntities(a,Kafkaf.CollisionListenerComponent.Type.PostSolve)};
Kafkaf.CollisionListenerSystem.notifyEntities=function(a,b){a=Box2D.wrapPointer(a,Box2D.b2Contact);var c=a.GetFixtureA(),d=a.GetFixtureB();if(c&&d){var e=c.GetBody().userData,f=d.GetBody().userData,g=new Kafkaf.CollisionData;g.normal[0]=a.GetManifold().get_localNormal().get_x();g.normal[1]=a.GetManifold().get_localNormal().get_y();var h=e.getComponent(Kafkaf.CollisionListenerComponent);h&&h[b]&&(h=Kafkaf.CollisionListenerSystem.callbacks[h[b]])&&(g.entityA=e,g.entityB=f,g.fixtureA=c,g.fixtureB=d,
h(g));(h=f.getComponent(Kafkaf.CollisionListenerComponent))&&h[b]&&(h=Kafkaf.CollisionListenerSystem.callbacks[h[b]])&&(g.entityA=f,g.entityB=e,g.fixtureA=d,g.fixtureB=c,h(g))}};Kafkaf.CollisionListenerSystem.prototype.getContactListener=function(){return this.contactListener};Kafkaf.ControllableSystem=function(){ES.System.call(this,[Kafkaf.ControllableComponent])};ES.Utils.extend(ES.System,Kafkaf.ControllableSystem);Kafkaf.ControllableSystem.prototype.onEvent=function(a){if(a instanceof Kafkaf.Event.UserEvent)for(var b=0;b<this.entities.length;b++)this.processEvent(a.event,this.entities[b])};
Kafkaf.ControllableSystem.prototype.processEvent=function(a,b){switch(a.type){case Core.Event.Type.KeyDown:case Core.Event.Type.KeyUp:var c=b.getComponent(Kafkaf.ControllableComponent);if(!c)break;var d=c.convertToAction(a.key);c.keyPressed[d]=a.type==Core.Event.Type.KeyDown;a.type==Core.Event.Type.KeyDown?(d==Kafkaf.ControllableComponent.ControlType.Up&&this.world.sendEvent(new Kafkaf.Event.JumpEvent(Kafkaf.Event.JumpEvent.Type.AskToJump,b)),d==Kafkaf.ControllableComponent.ControlType.Left?this.world.sendEvent(new Kafkaf.Event.MoveEvent(b,
-1)):d==Kafkaf.ControllableComponent.ControlType.Right&&this.world.sendEvent(new Kafkaf.Event.MoveEvent(b,1))):a.type==Core.Event.Type.KeyUp&&(c.keyPressed[Kafkaf.ControllableComponent.ControlType.Left]||c.keyPressed[Kafkaf.ControllableComponent.ControlType.Right]||this.world.sendEvent(new Kafkaf.Event.MoveEvent(b,0)))}};Kafkaf.JumpSystem=function(){ES.System.call(this,[Kafkaf.JumpComponent])};ES.Utils.extend(ES.System,Kafkaf.JumpSystem);Kafkaf.JumpSystem.prototype.update=function(a){for(var b=0;b<this.entities.length;b++){var c=this.entities[b].getComponent(Kafkaf.JumpComponent);c.jumpTimeOut=Math.max(c.jumpTimeOut-a,0)}};
Kafkaf.JumpSystem.prototype.onEvent=function(a){if(a instanceof Kafkaf.Event.JumpEvent){var b=a.entity.getComponent(Kafkaf.JumpComponent);if(a.type==Kafkaf.Event.JumpEvent.Type.AskToJump){if((a=a.entity.getComponent(Kafkaf.PhysicBodyComponent))&&b&&b.count<b.max&&0>=b.jumpTimeOut){var c=a.getVelocity();a.setLinearVelocity(c[0],-b.force);b.count++;b.jumpTimeOut=b.timeBetweenJump}}else a.type==Kafkaf.Event.JumpEvent.Type.ResetCounter&&(b.count=0)}};Kafkaf.LifeSystem=function(){ES.System.call(this,[Kafkaf.LifeComponent])};ES.Utils.extend(ES.System,Kafkaf.LifeSystem);Kafkaf.LifeSystem.prototype.onEvent=function(a){if(a instanceof Kafkaf.Event.DamageEvent){var b=a.victim.getComponent(Kafkaf.LifeComponent);--b.amount;0>=b.amount&&this.world.sendEvent(new Kafkaf.Event.DeadEvent(a.victim,a.agressor))}};Kafkaf.MoveSystem=function(){ES.System.call(this,[Kafkaf.MoveComponent,Kafkaf.PhysicBodyComponent])};ES.Utils.extend(ES.System,Kafkaf.MoveSystem);
Kafkaf.MoveSystem.prototype.update=function(a){for(a=0;a<this.entities.length;a++){var b=this.entities[a].getComponent(Kafkaf.MoveComponent),c=this.entities[a].getComponent(Kafkaf.PhysicBodyComponent),d=c.getVelocity();Math.abs(d[1]);var e=d[0],e=0>b.normal?Math.max(d[0]-b.accelerationScale,-b.speed):0<b.normal?Math.min(d[0]+b.accelerationScale,+b.speed):e*b.decelerationScale,b=e-d[0];(b*=c.getMass())&&c.applyLinearImpulse([b,0],[0,0])}};
Kafkaf.MoveSystem.prototype.onEvent=function(a){if(a instanceof Kafkaf.Event.MoveEvent){var b=a.entity.getComponent(Kafkaf.MoveComponent);b&&(b.normal=a.normal)}};Kafkaf.PhysicSystem=function(){ES.System.call(this,[Kafkaf.PhysicBodyComponent]);using(Box2D,"b2.+");this.physicWorld=null;this.bodiesToRemove=[];this.debugGraphicObject=null};ES.Utils.extend(ES.System,Kafkaf.PhysicSystem);Kafkaf.PhysicSystem.prototype.onActivation=function(){this.physicWorld&&Box2D.destroy(this.physicWorld);this.physicWorld=new b2World(new b2Vec2(0,25))};Kafkaf.PhysicSystem.prototype.onInactivation=function(){Box2D.destroy(this.physicWorld);this.physicWorld=null};
Kafkaf.PhysicSystem.prototype.onClear=function(){for(var a=0;a<this.entities.length;a++){var b=this.entities[a].getComponent(Kafkaf.PhysicBodyComponent);this.physicWorld.DestroyBody(b.instance)}this.bodiesToRemove.length=0;this.entities.length=0};
Kafkaf.PhysicSystem.prototype.update=function(a){this.physicWorld.Step(1/60,3,2);for(a=0;a<this.bodiesToRemove.length;a++)this.physicWorld.DestroyBody(this.bodiesToRemove[a]);for(a=this.bodiesToRemove.length=0;a<this.entities.length;a++){var b=this.entities[a].getComponent(Kafkaf.PhysicBodyComponent),c=this.entities[a].getComponent(Kafkaf.TransformComponent);c.position.x=b.instance.GetPosition().get_x();c.position.y=b.instance.GetPosition().get_y();c.rotation=b.instance.GetAngle()}this.debugGraphicObject&&
(this.debugGraphicObject.clear(),this.physicWorld.DrawDebugData())};Kafkaf.PhysicSystem.prototype.activateDebug=function(){this.debugGraphicObject=new PIXI.Graphics;this.physicWorld.SetDebugDraw(Kafkaf.Debug.getPIXIDebugDraw(this.debugGraphicObject));return this.debugGraphicObject};Kafkaf.PhysicSystem.prototype.onEntityRemoved=function(a){(a=a.getComponent(Kafkaf.PhysicBodyComponent))&&this.bodiesToRemove.push(a.instance)};Kafkaf.PlayerSystem=function(){ES.System.call(this);this.players=[]};ES.Utils.extend(ES.System,Kafkaf.PlayerSystem);Kafkaf.PlayerSystem.prototype.onClear=function(){this.players.length=0};
Kafkaf.PlayerSystem.prototype.createPlayer=function(a,b,c){var d=this.world.createEntity();d.setName(b);b=new Kafkaf.TransformComponent;b.position.x=c[0];b.position.y=c[1];d.addComponent(b);a.buildEntityFromPrefab(d,"Character");a=Kafkaf.Models.Configuration.getInstance().getController(this.players.length);c=new Kafkaf.ControllableComponent;c.setKey(Kafkaf.ControllableComponent.ControlType.Up,a.jump);c.setKey(Kafkaf.ControllableComponent.ControlType.Down,a.action);c.setKey(Kafkaf.ControllableComponent.ControlType.Left,
a.left);c.setKey(Kafkaf.ControllableComponent.ControlType.Right,a.right);d.addComponent(c);d.addComponent(new Kafkaf.LifeComponent(1));d.addComponent(new Kafkaf.MoveComponent);d.addComponent(new Kafkaf.JumpComponent(10,2));a=new Kafkaf.CollisionListenerComponent;a[0]="characterBegin";a[1]="characterEnd";d.addComponent(a);this.players.push(d)};
Kafkaf.PlayerSystem.prototype.onEvent=function(a){if(a instanceof Kafkaf.Event.DeadEvent){for(var b=-1,c=0;c<this.players.length;c++)this.players[c]==a.victim&&(b=c);-1<b&&this.players.splice(b,1)}};Kafkaf.PlayerSystem.prototype.getPlayerCount=function(){return this.players.length};Kafkaf.PlayerSystem.prototype.isPlayer=function(a){for(var b=0;b<this.players.length;b++)if(this.players[b]==a)return!0;return!1};Kafkaf.RendererSystem=function(a){ES.System.call(this);var b=document.getElementById(a);b?(this.renderer=PIXI.autoDetectRenderer(b.clientWidth,b.clientHeight,{backgroundColor:3355443,antialias:!0}),this.scene=new PIXI.Container,this.scene.scale.x=45,this.scene.scale.y=45,this.scene.position.x=b.clientWidth/2,this.scene.position.y=b.clientHeight/2,this.scene.position.y+=300,b.appendChild(this.renderer.view),this.setActif(!1)):console.log('Unable to found "'+a+'"')};ES.Utils.extend(ES.System,Kafkaf.RendererSystem);
Kafkaf.RendererSystem.prototype.update=function(a){for(a=0;a<this.entities.length;a++){var b=this.entities[a].getComponent(Kafkaf.SpriteComponent),c=this.entities[a].getComponent(Kafkaf.TransformComponent);b.instance.position.x=c.position.x;b.instance.position.y=c.position.y;b.instance.rotation=c.rotation;b.instance.scale.x=1/b.instance.texture.width*c.scale.x;b.instance.scale.y=1/b.instance.texture.height*c.scale.y}this.renderer.render(this.scene)};
Kafkaf.RendererSystem.prototype.onEntityAdded=function(a){a=a.getComponent(Kafkaf.SpriteComponent);this.scene.addChild(a.instance)};Kafkaf.Helpers.CollisionSolvers={};
Kafkaf.Helpers.CollisionSolvers.add=function(a){function b(){var a=Core.Application.getInstance();return a?(a=a.getGame().getSceneManager().getActiveScene())?a.getWorld():null:null}a.registerCollisionSolver("characterBegin",function(a){if("foot"==a.fixtureA.userData)b().sendEvent(new Kafkaf.Event.JumpEvent(Kafkaf.Event.JumpEvent.Type.ResetCounter,a.fixtureA.GetBody().userData));else if("head"==a.fixtureA.userData&&1<a.fixtureB.GetBody().GetLinearVelocity().get_y()){b().sendEvent(new Kafkaf.Event.DamageEvent(a.fixtureA.GetBody().userData,a.fixtureB.GetBody().userData));
var d=a.fixtureB.GetBody().GetLinearVelocity().get_x(),e=5*a.fixtureB.GetBody().GetMass();a.fixtureB.GetBody().SetLinearVelocity(new b2Vec2(d,-e))}});a.registerCollisionSolver("characterEnd",function(a){})};Kafkaf.Models.Level=function(a){this.world=a;this.entityBuilder=new Kafkaf.Helpers.EntityBuilder;this.spawnPoints=[];this.ready=!1};
Kafkaf.Models.Level.prototype.init=function(){this.entityBuilder.registerLoader("AIComponent",new Kafkaf.Loaders.AILoader);this.entityBuilder.registerLoader("CollisionListenerComponent",new Kafkaf.Loaders.CollisionListenerLoader);this.entityBuilder.registerLoader("PhysicBodyComponent",new Kafkaf.Loaders.PhysicBodyLoader(this.world.getSystem(Kafkaf.PhysicSystem)));this.entityBuilder.registerLoader("SpriteComponent",new Kafkaf.Loaders.SpriteLoader);return!0};
Kafkaf.Models.Level.prototype.getEntityBuilder=function(){return this.entityBuilder};Kafkaf.Models.Level.prototype.loadFromFile=function(a,b){this.ready=!1;var c=this;Utils.loadJSON(a,function(a){b(c.loadFromData(a))});return!0};
Kafkaf.Models.Level.prototype.loadFromData=function(a){this.world.removeEntities();this.spawnPoints.length=0;this.ready=!1;for(var b=0;b<a.spawns.length;b++)this.spawnPoints.push([a.spawns[b].x,a.spawns[b].y]);for(b=0;b<a.entities.length;b++){var c=a.entities[b],d=this.world.createEntity(),e=new Kafkaf.TransformComponent;c.position&&(e.position.x=c.position.x,e.position.y=c.position.y);c.scale&&(e.scale.x=c.scale.x,e.scale.y=c.scale.y);c.rotation&&(e.rotation=c.rotation);d.addComponent(e);c.name&&
d.setName(c.name);this.entityBuilder.buildEntityFromPrefab(d,c.prefab)}return this.ready=!0};Kafkaf.Models.Level.prototype.isLoaded=function(){return this.ready};Kafkaf.Models.Level.prototype.getSpawnPoints=function(){return this.spawnPoints};Kafkaf.Modes.TheOneMode=function(a){Kafkaf.Modes.GameMode.call(this,a);this.needToCheck=!1;this.scores=[]};goog.inherits(Kafkaf.Modes.TheOneMode,Kafkaf.Modes.GameMode);Kafkaf.Modes.TheOneMode.prototype.update=function(a){this.needToCheck&&!this.over&&(a=this.world.getSystem(Kafkaf.PlayerSystem))&&(1>=a.getPlayerCount()&&(this.world.sendEvent(new Kafkaf.Event.GameEvent(Kafkaf.Event.GameEvent.Type.GameOver)),this.over=!0),this.needToCheck=!1)};
Kafkaf.Modes.TheOneMode.prototype.onEvent=function(a){if(a instanceof Kafkaf.Event.DeadEvent){this.world.destroyEntity(a.victim);var b=this.world.getSystem(Kafkaf.PlayerSystem);b&&(b.isPlayer(a.killer)&&(this.scores[a.killer.id]=this.scores[a.killer.id]+1||1),this.needToCheck=!0)}};Kafkaf.GameSystem=function(){ES.System.call(this);this.level=this.mode=null};ES.Utils.extend(ES.System,Kafkaf.GameSystem);Kafkaf.GameSystem.prototype.onActivation=function(){this.level=new Kafkaf.Models.Level(this.world)};
Kafkaf.GameSystem.prototype.startNewGame=function(a,b,c){this.setMode(Kafkaf.Modes.GameMode.Mode.TheOne);var d=this;this.loadLevel(a,function(a){a=d.level.getSpawnPoints();for(var b=d.world.getSystem(Kafkaf.PlayerSystem),g=0;g<c;g++)b.createPlayer(d.level.getEntityBuilder(),"player_"+g,a[g])})};
Kafkaf.GameSystem.prototype.loadLevel=function(a,b){this.level.init();var c=this;this.level.getEntityBuilder().loadPrefabsFromFile("./assets/data/prefabs.json?"+Math.random(),function(d){d&&c.level.loadFromFile("./assets/data/"+a+"?"+Math.random(),function(a){b(a)})})};
Kafkaf.GameSystem.prototype.setMode=function(a){delete this.mode;switch(a){case Kafkaf.Modes.GameMode.Mode.MoneyHunter:this.mode=new Kafkaf.Modes.MoneyHunterMode(this.world);break;case Kafkaf.Modes.GameMode.Mode.TheOne:this.mode=new Kafkaf.Modes.TheOneMode(this.world);break;case Kafkaf.Modes.GameMode.Mode.TheCollector:this.mode=new Kafkaf.Modes.TheCollectorMode(this.world);break;case Kafkaf.Modes.GameMode.Mode.BombAvoider:this.mode=new Kafkaf.Modes.BombAvoiderMode(this.world);break;case Kafkaf.Modes.GameMode.Mode.Race:this.mode=
new Kafkaf.Modes.RaceMode(this.world);break;default:this.mode=new Kafkaf.Modes.TheSurvivorMode(this.world)}};Kafkaf.GameSystem.prototype.update=function(a){this.mode&&this.mode.update(a)};Kafkaf.GameSystem.prototype.onEvent=function(a){if(a instanceof Kafkaf.Event.GameEvent)this.startNewGame("level_test.json",Kafkaf.Modes.GameMode.Mode.TheOne,2);else if(this.mode)this.mode.onEvent(a)};ES.EntityEvent=function(a,b,c){ES.Event.call(this);this.entity=a;this.type=b;this.component=c};goog.inherits(ES.EntityEvent,ES.Event);ES.EntityEvent.Type={AddComponent:0,RemoveComponent:1};ES.Entity=function(a){this.id=ES.Entity.prototype.nextID++;this.world=a};ES.Entity.prototype.nextID=0;ES.Entity.prototype.addComponent=function(a){this.world.sendEvent(new ES.EntityEvent(this,ES.EntityEvent.Type.AddComponent,a))};ES.Entity.prototype.removeComponent=function(a){this.world.sendEvent(new ES.EntityEvent(this,ES.EntityEvent.Type.RemoveComponent,a))};ES.Entity.prototype.setName=function(a){this.world.setEntityName(a,this)};ES.Entity.prototype.getComponents=function(){return this.world.getComponents(this)};
ES.Entity.prototype.getComponent=function(a){return this.world.getComponent(this,a)};ES.World=function(){this.components=[];this.entities=[];this.waitingEvents=[];this.waitingAddUpdate=[];this.waitingRemoveUpdate=[];this.systems=[];this.entitiesNames=[]};ES.World.prototype.clear=function(){this.removeEntities();for(var a=0;a<this.systems.length;a++)this.systems[a].onInactivation();this.systems.length=0};
ES.World.prototype.removeEntities=function(){for(var a=0;a<this.systems.length;a++){this.systems[a].onClear();for(var b=0;b<this.systems[a].entities.length;b++)this.systems[a].removeEntity(this.systems[a].entities[b]);this.systems[a].entities.length=0}this.entities.length=0;this.components.length=0;this.entitiesNames.length=0;this.waitingRemoveUpdate.length=0;this.waitingAddUpdate.length=0;this.waitingEvents.length=0};
ES.World.prototype.createEntity=function(){var a=new ES.Entity(this);this.entities.push(a);return a};ES.World.prototype.destroyEntity=function(a){this.waitingRemoveUpdate.push({entity:a,components:[]});for(var b in this.entitiesNames)this.entitiesNames[b]==a&&(this.entitiesNames[b]=null)};ES.World.prototype.addSystem=function(a){a.world=this;a.onActivation();this.systems.push(a)};
ES.World.prototype.update=function(a){for(var b=0;b<this.waitingEvents.length;b++){var c=this.waitingEvents[b],d=this.components[c.entity.id]||[];switch(c.type){case ES.EntityEvent.Type.AddComponent:this.waitingAddUpdate[c.entity.id]=c.entity;break;case ES.EntityEvent.Type.RemoveComponent:d[c.component.UID]&&(this.waitingRemoveUpdate[this.waitingRemoveUpdate.length]=this.waitingRemoveUpdate[c.entity.id]||{entity:c.entity,components:[]},this.waitingRemoveUpdate[c.entity.id].components.push(c.component.UID))}this.components[c.entity.id]=
d}this.waitingEvents=[];for(var e in this.waitingAddUpdate){var d=this.components[e],c=0,f;for(f in d)d[f]&&(c|=f);for(b=0;b<this.systems.length;b++)0!=this.systems[b].key&&(c&this.systems[b].key)==this.systems[b].key&&this.systems[b].addEntity(this.waitingAddUpdate[e])}for(b=this.waitingAddUpdate.length=0;b<this.waitingRemoveUpdate.length;b++)if(e=this.waitingRemoveUpdate[b],0==e.components.length){for(b=0;b<this.systems.length;b++)this.systems[b].isPresent(e.entity)&&this.systems[b].removeEntity(e.entity);
for(b in this.components[e.entity.id])delete this.components[e.entity.id][b];this.components[e.entity.id].length=0}else{d=this.components[e.entity.id];c=0;for(f in d)d[f]&&(c|=f);for(b=0;b<this.systems.length;b++)this.systems[b].isPresent(e.entity)&&(c&this.systems[b].key)!=this.systems[b].key&&this.systems[b].removeEntity(e.entity);for(b in e.components)delete d[b],d[b]=null}for(b=this.waitingRemoveUpdate.length=0;b<this.systems.length;b++)this.systems[b].enabled&&this.systems[b].update(a)};
ES.World.prototype.sendEvent=function(a){if(a instanceof ES.EntityEvent){if(a.type==ES.EntityEvent.Type.AddComponent){var b=this.components[a.entity.id]||[];b[a.component.UID]=a.component;this.components[a.entity.id]=b}this.waitingEvents[this.waitingEvents.length]=a}for(b=0;b<this.systems.length;b++)this.systems[b].onEvent(a)};ES.World.prototype.setEntityName=function(a,b){this.entitiesNames[a]=b};ES.World.prototype.getComponents=function(a){return this.components[a.id]||[]};
ES.World.prototype.getComponent=function(a,b){var c=this.getComponents(a);return c?c[b.prototype.UID]||null:null};ES.World.prototype.getSystem=function(a){for(var b=0;b<this.systems.length;b++)if(this.systems[b]instanceof a)return this.systems[b];return null};ES.World.prototype.getEntityWithName=function(a){return this.entitiesNames[a]||null};Kafkaf.GameScene=function(){Core.Scene.call(this);this.world=new ES.World;this.rendererSystem=null};Kafkaf.GameScene.prototype.onActivation=function(){var a=this.world.getSystem(Kafkaf.GameSystem);a&&a.startNewGame("level_test.json",Kafkaf.Modes.GameMode.Mode.TheOne,2)};Kafkaf.GameScene.prototype.onInactivation=function(){};
Kafkaf.GameScene.prototype.onLoad=function(){this.world.addSystem(new Kafkaf.AISystem);this.world.addSystem(new Kafkaf.RendererSystem("application"));this.world.addSystem(new Kafkaf.PhysicSystem);this.world.addSystem(new Kafkaf.CollisionListenerSystem);this.world.addSystem(new Kafkaf.ControllableSystem);this.world.addSystem(new Kafkaf.GameSystem);this.world.addSystem(new Kafkaf.LifeSystem);this.world.addSystem(new Kafkaf.JumpSystem);this.world.addSystem(new Kafkaf.MoveSystem);this.world.addSystem(new Kafkaf.PlayerSystem);
this.rendererSystem=this.world.getSystem(Kafkaf.RendererSystem);var a=this.world.getSystem(Kafkaf.PhysicSystem),b=this.world.getSystem(Kafkaf.CollisionListenerSystem);a.physicWorld.SetContactListener(b.getContactListener());Kafkaf.Helpers.CollisionSolvers.add(b);a=a.activateDebug();this.rendererSystem.scene.addChild(a)};Kafkaf.GameScene.prototype.onUnload=function(){this.world.clear()};Kafkaf.GameScene.prototype.update=function(a){this.world.update(a)};Kafkaf.GameScene.prototype.render=function(a){this.rendererSystem.update(a)};
Kafkaf.GameScene.prototype.onEvent=function(a){this.world.sendEvent(new Kafkaf.Event.UserEvent(a))};Kafkaf.GameScene.prototype.getWorld=function(){return this.world};Kafkaf.Game=function(){Core.Game.call(this)};goog.inherits(Kafkaf.Game,Core.Game);Kafkaf.Game.prototype.init=function(){var a=this;Kafkaf.Models.Configuration.getInstance().loadFromFile("./assets/data/config.json",function(b){a.sceneManager.pushScene(new Kafkaf.GameScene)});return!0};Kafkaf.Main={};window.onload=function(){var a=Core.Application.getInstance();a.init(new Kafkaf.Game)&&a.start()};
